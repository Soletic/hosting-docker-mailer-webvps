# Mailer service as docker image

Docker image to send mail found in several queue directories.

It's useful to plug a mailer checking mails generated by others containers like [phpserver](https://github.com/Soletic/hosting-docker-phpserver). If the phpserver container runs with the option storing mail as queue instead of sending immediatly, this mailer will do the job. Very useful if you have several app containers and you don't want to allow them to send itself emails.

If you have your own app container having to send mail, get inspiration from the [phpserver](https://github.com/Soletic/hosting-docker-phpserver) to add nullmailer and a little bash script exposing its queue in a volume which will map with the mailer throught the host.

## How does it work ?

The container searchs all directories matching pattern ```mail/queue``` in the ${DATA_VOLUME_HOME} and all mails inside will be sent using
smtp credentials.

At the same level of the queue directory, two directories will be created to store after trying the sent : ```sent``` and ```failed```.

The file ${DATA_VOLUME_HOME}/log/mail.log logs failed and success messages (with log rotation to save disk space).

Mail older than 90 days are deleted regularly.

## Install and run

```
$ git clone https://github.com/Soletic/hosting-docker-mailer-webvps.git ./mailer-webvps
$ docker build -t soletic/mailer-webvps ./mailer-webvps
```

```
$ docker run -d -h mailer.example.org -v /path/host:/home --name mailer.webvps -e MAILER_SMTP=<smtp.example.org>:user:password:no:no soletic/mailer-webvps
```

It's important to precise the hostname of the container with ```-h mailer.example.org``` because all emails sent will be overidden to change :

* The sender enveloppe and From header by an email like ```*@mailer.example.org``` where ```*``` will be the previous enveloppe mail by replacing @ and . with -
* We keep the From name and we move the previsous From email in Reply-To header (if doesn't exist).

It's a security to prevent alert when a email sender is unknown by mailjet.